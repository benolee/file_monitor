#!/usr/bin/env ruby

require 'bundler/setup'
require 'trollop'
#TODO Move all this to class so it can be tested..

file_monitor_banner  = <<-EOT
Usage: file_monitor -c /path/to/config.yml COMMAND [ARGS]

The file monitor commands are:
 start          Starts the file monitor and watches a specified directory.
 stop           Stops the file monitor
 --version
EOT

sub_commands = %w(start stop)

global_opts = Trollop::options do
  banner file_monitor_banner
  opt :config_path, "Configuration Path", :short => "-c", :type => :string
  stop_on sub_commands
end

command  = ARGV.shift # get the subcommand
cmd_opts = case command
  when "start"
    require File.expand_path('../../lib/file_monitor', __FILE__)
    Trollop::options do
      opt :config_path, "Configuration Path", :short => "c"
    end

    watch_dir   = ARGV.unshift
    config_path = global_opts[:config_path]
    FileMonitor::Core.new(:config_path => config_path, :watch_dir => File.expand_path(File.join(watch_dir))).run
  when "stop"
  else
    Trollop::die "unknown command #{command.inspect}"
  end

